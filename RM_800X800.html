<html>
<head>
    <script type="text/javascript">
        var clickTag = "{{LANDING_PAGE_URL}}";
    </script>
    <script type="text/javascript" src="https://s.adx.io/html5/v1/dxstream.min.js"></script>
</head>
<body>
    <canvas id="snoweffect"></canvas>
	<div id="overlay">
		<a href="javascript:window.open(clickTag,'_blank')">
			<img class="forgroundImage" src="{{FOREGROUND_IMAGE}}"/>
		</a>
	</div>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            height: 100%;
        }

        canvas {
            width: 800px;
            height: 800px;
            position: absolute;
            top: 0;
            left: 0;
            background-image: url('{{BACKGROUND_IMAGE}}')
        }
		
		.forgroundImage{
            width: 800px;
            height: 800px;
		}
		
		#overlay {
		  position: fixed;
          width: 800px;
          height: 800px;
		  top: 0;
		  left: 0;
		  right: 0;
		  bottom: 0;
		  z-index: 100;
		  cursor: pointer;
		}
    </style>
    <script>
        (function () {
            var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 200 / 60);
                };
            window.requestAnimationFrame = requestAnimationFrame;
        })();

        var foregroundImgLoaded = false;
        var backgroundImgLoaded = false;
        const width = 800;
        var height = 800;
        var foregroundImg = new Image();
        var backgroundImg = new Image();       
        foregroundImg.src = 'https://s3.amazonaws.com/rich.media.builder.templates.development/RichMediaAdShowcase/ShowcaseAssets/DefaultTemplateAssets/Snow/Snow+-+Foreground.png';
        backgroundImg.src = 'https://s3.amazonaws.com/rich.media.builder.templates.development/RichMediaAdShowcase/ShowcaseAssets/DefaultTemplateAssets/Snow/Snow+-+Background.png';
        
        var flakes = [],
            canvas = document.getElementById("snoweffect"),
            ctx = canvas.getContext("2d"),
            flakeCount = Math.min((800 * 800) * 0.002, 50),
            mX = -100,
            mY = -100

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        function snow() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (var i = 0; i < flakeCount; i++) {
                var flake = flakes[i],
                    x = mX,
                    y = mY,
                    minDist = 150,
                    x2 = flake.x,
                    y2 = flake.y;

                var dist = Math.sqrt((x2 - x) * (x2 - x) + (y2 - y) * (y2 - y)),
                    dx = x2 - x,
                    dy = y2 - y;

                if (dist < minDist) {
                    var force = minDist / (dist * dist),
                        xcomp = (x - x2) / dist,
                        ycomp = (y - y2) / dist,
                        deltaV = force / 2;

                    flake.velX -= deltaV * xcomp;
                    flake.velY -= deltaV * ycomp;

                } else {
                    flake.velX *= .98;
                    if (flake.velY <= flake.speed) {
                        flake.velY = flake.speed
                    }
                    flake.velX += Math.cos(flake.step += .05) * flake.stepSize;
                }

                ctx.fillStyle = "rgba(255,255,255," + flake.opacity + ")";
                flake.y += flake.velY;
                flake.x += flake.velX;

                if (flake.y >= canvas.height || flake.y <= 0) {
                    reset(flake);
                }


                if (flake.x >= canvas.width || flake.x <= 0) {
                    reset(flake);
                }

                ctx.beginPath();
                ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
                ctx.fill();
            }
            requestAnimationFrame(snow);
        };

        function reset(flake) {
            flake.x = Math.floor(Math.random() * canvas.width);
            flake.y = 0;
            flake.size = (Math.random() * 2) + 1;
            flake.speed = (Math.random() * 1) + 0.5;
            flake.velY = flake.speed;
            flake.velX = 0;
            flake.opacity = (Math.random() * 0.5) + 0.3;
        }

        function init() {
            for (var i = 0; i < flakeCount; i++) {
                var x = Math.floor(Math.random() * canvas.width),
                    y = Math.floor(Math.random() * canvas.height),
                    size = (Math.random() * 2) + 1,
                    speed = (Math.random() * size) + 0.5,
                    opacity = (Math.random() * size) + 0.3;

                flakes.push({
                    speed: speed,
                    velY: speed,
                    velX: 0,
                    x: x,
                    y: y,
                    size: size,
                    stepSize: (Math.random()) / 60,
                    step: 0,
                    opacity: opacity
                });
            }
            snow();
        };

        canvas.addEventListener("mousemove", function (e) {
            mX = e.clientX,
            mY = e.clientY
        });

        window.addEventListener("resize", function () {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        })

        foregroundImg.onload = function () {
            foregroundImgLoaded = true;
            if (foregroundImgLoaded && backgroundImgLoaded) {
                init();
            }
        }
        
        backgroundImg.onload = function () {
            backgroundImgLoaded = true;
            if (foregroundImgLoaded && backgroundImgLoaded) {
                init();
            }
        }
    </script>
</body>
</html>